Though most of the film is set in Afghanistan , these parts were mostly shot in Kashgar , China , due to the dangers of filming in Afghanistan at the time.