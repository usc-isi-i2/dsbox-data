The agglomerate consists of Kathmandu Metropolitan City at its core, and its sister cities Patan , Kirtipur , Thimi , and Bhaktapur .